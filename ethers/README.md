# Ethers.js

## Outline

### 1. 介绍和设置

- Ethers.js 的优势
- Ethers.js 的核心模块
- Ethers.js 典型应用场景

### 2. 连接以太坊网络

- **连接到默认网络**：
  - 如何通过默认提供程序（Infura、Alchemy、Etherscan 等）连接到主网或测试网。
- **使用自定义提供程序**：
  - 使用 JsonRpcProvider 和 InfuraProvider 等方法连接到特定的以太坊节点。
  - 设置私有网络和自定义 RPC 端点。

---

### 3. 钱包和账户管理

- **创建和导入钱包**：

  - 创建新钱包、生成助记词和私钥。
  - 从助记词或私钥导入现有钱包。

- **与钱包进行交互**：
  - 查询钱包余额，使用 `ethers.utils.formatEther` 格式化余额。
  - 加载钱包至提供程序，进行基本的以太坊账户操作。

---

### 4. 发送交易

- **构建和发送基本交易**：

  - 构建交易对象，包含 `to`、`value`、`gasLimit`、`gasPrice` 等字段。
  - 使用 `sendTransaction()` 方法发送交易，解析交易的哈希值。

- **处理交易事件和接收确认**：
  - 如何监听交易事件。
  - 设置不同数量的确认，以确保交易安全。

---

### 5. 与智能合约交互

- **ABI 和合约对象**：

  - ABI 的概念，如何从合约中获取 ABI。
  - 使用 ABI 和合约地址创建合约对象实例。

- **调用合约的读取和写入方法**：
  - 使用 `callStatic` 进行合约状态的只读查询（如 `balanceOf`、`totalSupply` 等）。
  - 使用 `sendTransaction` 进行合约写入（如 `transfer`、`approve` 等）。

---

### 6. 事件监听

- **监听合约事件**：

  - 使用 `on` 方法监听合约事件（如 Transfer、Approval 等）。
  - 解析事件的返回参数。

- **全局事件监听**：
  - 监听网络中的所有新区块和交易事件。
  - 使用过滤器筛选特定类型的交易或合约调用。

---

### 7. 实用工具和高级功能

- **Ethers.js 实用工具**：

  - `ethers.utils` 中常用的工具（例如，`parseEther`、`formatEther`、`keccak256` 哈希函数、签名、加密等）。
  - 使用 `ethers.BigNumber` 进行大整数计算。

- **与 ENS (Ethereum Name Service) 交互**：
  - 解析 ENS 名称到地址，反向解析地址到 ENS 名称。
- **离线签名与 EIP-712**：
  - 离线签名交易与消息，减少与节点的交互频率。
  - 使用 EIP-712 标准进行结构化数据签名和验证。

---

### 8. 合约部署和测试

- **使用 Ethers.js 部署合约**：

  - 构建部署脚本，使用私钥或钱包对象将合约部署到网络。
  - 验证部署结果，获取合约地址。

- **合约测试**：
  - 使用 Ethers.js 与 Hardhat 或 Foundry 结合进行合约测试。
  - 编写 Ethers.js 测试脚本，确保合约的关键功能正常工作。

---

### 9. 调试和错误处理

- **捕获和处理错误**：

  - 处理合约调用或交易失败的常见错误。
  - 使用 Ethers.js 的调试工具检查交易回滚原因。

- **测试网络与模拟**：
  - 使用 Hardhat、Ganache 等本地环境进行测试和模拟，确保代码在主网部署前稳定运行。

---

### 10. 实战项目

- **编写与 NFT 合约交互的脚本**：

  - 创建脚本实现与 ERC721 合约的交互。
  - 示例：获取 NFT 的所有权信息、查询元数据 URI。

- **编写 DeFi 应用交互脚本**：
  - 示例：与 Uniswap、Aave 等常用 DeFi 协议合约交互，执行基础操作。
- **前端集成**：
  - 将 Ethers.js 脚本集成到前端应用中，展示钱包余额、代币列表或交易历史。
  - 使用 Metamask 进行连接并授权账户访问权限。

---

通过上述大纲的详细讲解，读者可以从基础到进阶掌握 Ethers.js 的核心功能，实现与以太坊网络和智能合约的安全交互。

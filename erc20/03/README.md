# ERC20 çš„è½¬è´¦é€»è¾‘

ä¸Šä¸€ç« èŠ‚æˆ‘ä»¬ä¸ºè‡ªå·±çš„ Token è®¾ç½®äº†å¿…è¦çš„å˜é‡ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°†åˆ›å»ºä¸€äº›å¿…è¦çš„å‡½æ•°ï¼Œæ¥å®Œå–„ Token çš„åŠŸèƒ½ã€‚

## Transfer

æˆ‘ä»¬çš„ Token ç¼ºå°‘ä¸€ä¸ªè‡³å…³é‡è¦çš„åŠŸèƒ½ï¼Œé‚£å°±æ˜¯è½¬è´¦ã€‚è½¬è´¦çš„æœ¬è´¨å…¶å®æ˜¯åœ¨è½¬å‡ºè´¦æˆ·çš„ä½™é¢å‡å»æŒ‡å®šæ•°é‡ï¼ŒåŒæ—¶åœ¨è½¬å…¥è´¦æˆ·ä½™é¢ä¸ŠåŠ ä¼¤æŒ‡å®šæ•°é‡ï¼Œå¦å¤–æˆ‘ä»¬éœ€è¦åœ¨è½¬è´¦ä¹‹å‰åšä½™é¢æ˜¯å¦å……è¶³çš„æ¡ä»¶æ£€æŸ¥ã€‚

å¦å¤–æˆ‘ä»¬è¿˜éœ€è¦ä¸ºè½¬è´¦è¡Œä¸ºå‘é€ä¸€ä¸ª event ä»¥ä¾¿é“¾ä¸‹è¿½è¸ªç»Ÿè®¡ã€‚

æ‰€ä»¥æˆ‘ä»¬çš„ä»£ç é€»è¾‘åº”è¯¥æ˜¯è¿™æ ·å­çš„ï¼š

```solidity
function transfer(address to, uint256 amount) {
    // 1. æ£€æŸ¥ msg.sender ä½™é¢æ˜¯å¦è¶³ä»¥æ”¯ä»˜è¿™æ¬¡è½¬è´¦
    // 2. æ‰£é™¤ msg.sender ä½™é¢
    // 3. åŠ ä¸Š to çš„ä½™é¢
    // 4. å‘é€ event
}
```

## Approve & TransferFrom

Transfer æ˜¯ä¸€ä¸ªä¸»åŠ¨è½¬è´¦çš„æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´å¿…é¡»ç”±èµ„äº§æ‹¥æœ‰è€…è‡ªå·±å‘èµ·è½¬è´¦ã€‚ä½†è¿™æ ·å¹¶ä¸åˆ©äºç¨‹åºä¹‹é—´çš„å¯ç»„åˆæ€§ï¼Œä¾‹å¦‚æˆ‘å¸Œæœ›å°†è‡ªå·±çš„ Token A äº¤æ˜“ä¸º Token Bï¼Œå°±å¿…é¡»å…ˆå°† Token A è½¬ç»™ Dex ï¼ˆå»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€ï¼‰ï¼Œç„¶åè°ƒç”¨ Dex çš„äº¤æ˜“ç›¸å…³æ–¹æ³•è¿›è¡Œäº¤æ˜“ã€‚æ˜¾ç„¶è¿™æ ·æ˜¯ç¼ºä¹æ•ˆç‡çš„ï¼Œç†æƒ³æƒ…å†µæ˜¯è¿™ä¸¤ä¸ªæ“ä½œåœ¨åŒä¸€ç¬”äº¤æ˜“ä¸­å®Œæˆã€‚

æ‰€ä»¥æˆ‘ä»¬éœ€è¦å®ç°ä¸€ä¸ªæˆæƒ+è¢«åŠ¨è½¬è´¦çš„æµç¨‹ï¼Œä¾‹å¦‚æˆ‘ä»¬ç»™ Dex åˆçº¦æˆæƒä¸€å®šçš„é¢åº¦ï¼Œè®©ä»–ä»¬çš„åˆçº¦å¯ä»¥ç›´æ¥è½¬èµ°æˆ‘åä¸‹çš„éƒ¨åˆ†èµ„äº§ç”¨äºäº¤æ˜“ã€‚å…¶ä»£ç é€»è¾‘åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š

1. è°ƒç”¨æˆæƒå‡½æ•°ï¼Œç»™ç›®æ ‡åœ°å€æˆæƒé¢åº¦
2. ç›®æ ‡åœ°å€è°ƒç”¨å‡½æ•°è½¬èµ°èµ„äº§

åœ¨ERC20ä¸­ï¼Œè¿™ä¸¤æ­¥æ‰€å¯¹åº”çš„å‡½æ•°åˆ†åˆ«æ˜¯ `approve` å’Œ `transferFrom`ã€‚å¦å¤–ï¼Œä¸ºäº†è®°å½• approve ç›¸å…³çš„æ•°æ®ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ª `allowance` mapping å˜é‡ï¼Œä»¥åŠä¸€ä¸ª approve ç›¸å…³çš„ eventã€‚

```solidity
event Approval(...);
// owner => spender => value
mapping(address => mapping(address => uint256)) public allowance;
```

è€Œåœ¨ transferFrom å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å°†å…ˆæ£€æŸ¥ allowanceï¼Œ`owner` æ˜¯å¦ä¸º `spender` æˆæƒäº†è¶³å¤Ÿçš„é¢åº¦ï¼Œç„¶åé‡å¤ `transfer` å‡½æ•°ä¸­çš„é€»è¾‘ã€‚

## ğŸ ç›®æ ‡

ä¸ºåˆçº¦æ·»åŠ ä»¥ä¸‹å‡½æ•°ï¼š

- `transfer`: è½¬è´¦å‡½æ•°
- `approve`: `owner` ä¸º `spender` æˆæƒè½¬è´¦é¢åº¦
- `transferFrom`: `spender` è½¬èµ° `owner` èµ„äº§

å¹¶ä¸”æ·»åŠ ç›¸åº”çš„ event:

- `event Transfer` (transfer, transferFrom å‡½æ•°éƒ½å‘é€è¿™ä¸ªevent)
- `event Approval`
